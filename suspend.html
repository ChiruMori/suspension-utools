<!DOCTYPE html>
<html>
<style type="text/css">
    body {
        -webkit-app-region: drag;
        -webkit-user-select: none;
        margin: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        overflow-x: hidden;
        overflow-y: hidden;
    }

    img {
        opacity: 1;
        transition: 0.3s opacity;
        transition: all 0.3s ease-in-out;
    }

    img:hover {
        opacity: 0.8;
        transition: 0.3s opacity;
    }
</style>

<body scroll="no">
    <img draggable="false" />
</body>

<script type="application/javascript">
    let img = document.querySelector("img")
    const src = window.location.hash.substring(1);
    img.src = src;
    let rotate = 0;

    if (!window.resize) {
        window.resize = () => { }
        window.mv = () => { }
    }

    function windowResize(width, height) {
        if (rotate / 90 % 2 != 1) {
            //横着
            window.resize(width, height);
        } else {
            // 竖着
            window.resize(height, width);
        }
    }

    document.addEventListener("keydown", event => {
        console.log(event.key);
        switch (event.key) {
            case "Escape":
                window.close();
                break;
            case "ArrowUp":
                window.mv(0, -1);
                break;
            case "ArrowDown":
                window.mv(0, 1);
                break;
            case "ArrowLeft":
                window.mv(-1, 0);
                break;
            case "ArrowRight":
                window.mv(1, 0);
                break;
            case "=":
                windowResize(img.width + 7, img.height);
                break;
            case "-":
                if (img.width > 100) {
                    windowResize(img.width - 7, img.height);
                }
                break;
            case "[": {
                let width = img.width;
                let height = img.height;
                //固定高宽.
                img.style.width = width + 'px';
                img.style.height = height + 'px';
                //改变窗口位置和大小
                //计算动画外接圆直径
                let R = Math.sqrt(width * width + height * height);
                //设置最终大小
                document.body.style.width = R + 'px';
                document.body.style.height = R + 'px';
                //图片居中
                let xOffset = (R - width) / 2;
                let yOffset = (R - height) / 2;
                img.style.position = "relative";
                img.style.left = xOffset + 'px';
                img.style.top = yOffset + 'px';
                window.mv(-xOffset, -yOffset, R, R);

                //旋转动画
                rotate -= 90;
                img.style.webkitTransform = `rotateZ(${rotate}deg)`
                let reduction = () => {
                    img.removeEventListener('webkitTransitionEnd', reduction);
                    let width = img.width;
                    let height = img.height;
                    //动画执行完毕后窗口复原

                    window.mv(yOffset, xOffset, height, width);
                    document.body.style.width = '100%';
                    document.body.style.height = '100%';
                    img.style.position = "static";
                    // img.style.width = width + 'px';
                    // img.style.height = heigh + 'px';
                    img.style.width = '100%';
                    img.style.height = '100%';


                }
                img.addEventListener('webkitTransitionEnd', reduction);
                break;
            }
            case "]": {
                let width = img.width;
                let height = img.height;
                rotate += 90;
                document.body.style.webkitTransform = `rotateZ(${rotate}deg)`
                // windowResize(width, height);
                break;
            }
            //Home
            //End
            //PageUp
            //PageDown
        }
    });
    document.body.addEventListener("mousewheel", (e) => {
        var delta = Math.max(-1, Math.min(1, (e.wheelDelta || -e.detail)));
        if (delta < 0 && img.width <= 100) {
            return false;
        }
        windowResize(img.width + (7 * delta), img.height);
        // windowResize();
        return false;
    }, false);

</script>

</html>