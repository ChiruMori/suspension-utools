<!DOCTYPE html>
<html>
<style type="text/css">
    body {
        margin: 0px;
        overflow: hidden;
        overflow-x: hidden;
        overflow-y: hidden;
    }

    img:hover {
        opacity: 0.8;
    }

    img {
        -webkit-app-region: drag;
        -webkit-user-select: none;
        opacity: 1;
        transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
    }

    div {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
    }
</style>

<body scroll="no" class="ui-flex justify-center center">
    <div class="cell">
        <img draggable="false" />
    </div>
</body>

<script type="application/javascript">
    let lock = false;
    let zoomTime = {
        lastKey: null,
        time: 0
    }
    let img = document.querySelector("img")
    img.src = window.location.hash.substring(1);
    window.rotateZ = 0;
    window.rotateX = 0;
    window.rotateY = 0;
    window.onRender = (width, height) => {
        img.style.width = width + 'px';
        img.style.height = height + 'px';
    }
    function query(queryName) {
        var query = decodeURI(window.location.search.substring(1));
        var vars = query.split("&");
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split("=");
            if (pair[0] == queryName) { return pair[1]; }
        }
        return null;
    }
    window.onRender(query('width'), query('height'));

    document.addEventListener("keydown", event => {
        if (zoomTime.lastKey === event.key) {
            zoomTime.time++;
        } else {
            zoomTime.lastKey = event.key;
            zoomTime.time = 3;
        }
        switch (event.key) {
            case "Escape":
                window.close();
                break;
            case "ArrowUp":
                window.moveBounds(0, -1);
                break;
            case "ArrowDown":
                window.moveBounds(0, 1);
                break;
            case "ArrowLeft":
                window.moveBounds(-1, 0);
                break;
            case "ArrowRight":
                window.moveBounds(1, 0);
                break;
            case "=":
                window.moveBounds(0, 0, img.width + zoomTime.time / 3 * 10, img.height);
                break;
            case "-":
                if (img.width > 100) {
                    window.moveBounds(0, 0, img.width - zoomTime.time / 3 * 10, img.height);
                }
                break;
            //旋转相关
            case "【":
            case "[": {
                window.rotateZ -= 90;
                img.style.webkitTransform = `rotateX(${window.rotateX}deg) rotateY(${window.rotateY}deg) rotateZ(${window.rotateZ}deg)`
                break;
            }
            case "】":
            case "]": {
                window.rotateZ += 90;
                img.style.webkitTransform = `rotateX(${window.rotateX}deg) rotateY(${window.rotateY}deg) rotateZ(${window.rotateZ}deg)`
                break;
            }
            //左右反转
            case "Home":
            case "End":
                window.rotateY += 180;
                img.style.webkitTransform = `rotateX(${window.rotateX}deg) rotateY(${window.rotateY}deg) rotateZ(${window.rotateZ}deg)`
                break;
            //上下反转
            case "PageUp":
            case "PageDown":
                window.rotateX -= 180;
                img.style.webkitTransform = `rotateX(${window.rotateX}deg) rotateY(${window.rotateY}deg) rotateZ(${window.rotateZ}deg)`
                break;
        }
    });
    document.body.addEventListener("mousewheel", (e) => {
        var delta = Math.max(-1, Math.min(1, (e.wheelDelta || -e.detail)));
        if (delta < 0 && img.width <= 100) {
            return false;
        }
        window.resize(img.width + (7 * delta), img.height);
        return false;
    }, false);
</script>

</html>